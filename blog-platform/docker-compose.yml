version: '3.8'

services:
  # 前端服务
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: blog-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - blog-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # 后端服务（预留配置，待后端开发完成后取消注释并修改）
  backend:
    image: nginx:alpine  # 临时占位，后续替换为实际后端镜像
    container_name: blog-backend
    # build:
    #   context: ./backend
    #   dockerfile: Dockerfile
    ports:
      - "8080:8080"
    # environment:
    #   - SPRING_PROFILES_ACTIVE=prod
    #   - DATABASE_URL=jdbc:mysql://db:3306/blog_platform
    #   - DATABASE_USERNAME=blog_user
    #   - DATABASE_PASSWORD=your_password
    #   - JWT_SECRET=your_jwt_secret_key
    # depends_on:
    #   - db
    #   - redis
    networks:
      - blog-network
    restart: unless-stopped
    # volumes:
    #   - upload-data:/app/uploads

  # 数据库服务（MySQL）
  # db:
  #   image: mysql:8.0
  #   container_name: blog-mysql
  #   environment:
  #     MYSQL_ROOT_PASSWORD: root_password
  #     MYSQL_DATABASE: blog_platform
  #     MYSQL_USER: blog_user
  #     MYSQL_PASSWORD: your_password
  #   ports:
  #     - "3306:3306"
  #   volumes:
  #     - mysql-data:/var/lib/mysql
  #     - ./init-db:/docker-entrypoint-initdb.d  # 初始化 SQL 脚本
  #   networks:
  #     - blog-network
  #   restart: unless-stopped
  #   command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  # Redis 缓存（可选）
  # redis:
  #   image: redis:7-alpine
  #   container_name: blog-redis
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - blog-network
  #   restart: unless-stopped
  #   command: redis-server --appendonly yes

networks:
  blog-network:
    driver: bridge

# 数据卷（取消注释以启用）
# volumes:
#   mysql-data:
#   redis-data:
#   upload-data:
